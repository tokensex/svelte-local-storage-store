{"version":3,"sources":["../index.ts"],"sourcesContent":["import {writable as internal, get, Writable} from 'svelte/store'\n\ndeclare type Updater<T> = (value: T) => T;\ndeclare type StoreDict<T> = { [key: string]: Writable<T> }\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nconst stores: StoreDict<any> = {}\n\nexport function writable<T>(key: string, initialValue: T): Writable<T> {\n  const browser = typeof(localStorage) != 'undefined'\n\n  function updateStorage(key: string, value: T) {\n    if (!browser) return\n\n    localStorage.setItem(key, JSON.stringify(value))\n  }\n\n  if (!stores[key]) {\n    const store = internal(initialValue, (set) => {\n      const json = browser ? localStorage.getItem(key) : null\n\n      // Preserve existing storage if exists\n      if (browser) {\n        json ? localStorage.setItem(key, json) : localStorage.setItem(key, JSON.stringify(initialValue))\n      }\n\n      if (json) {\n        set(<T> JSON.parse(json))\n      }\n\n      if (browser) {\n        const handleStorage = (event: StorageEvent) => {\n          if (event.key === key)\n            set(event.newValue ? JSON.parse(event.newValue) : null)\n        }\n\n        window.addEventListener(\"storage\", handleStorage)\n\n        return () => window.removeEventListener(\"storage\", handleStorage)\n      }\n    })\n\n    const {subscribe, set} = store\n\n    stores[key] = {\n      set(value: T) {\n        updateStorage(key, value)\n        set(value)\n      },\n      update(updater: Updater<T>) {\n        const value = updater(get(store))\n\n        updateStorage(key, value)\n        set(value)\n      },\n      subscribe\n    }\n  }\n\n  return stores[key]\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkD;AAMlD,IAAM,SAAyB,CAAC;AAEzB,kBAAqB,KAAa,cAA8B;AACrE,QAAM,UAAU,OAAO,gBAAiB;AAExC,yBAAuB,MAAa,OAAU;AAC5C,QAAI,CAAC;AAAS;AAEd,iBAAa,QAAQ,MAAK,KAAK,UAAU,KAAK,CAAC;AAAA,EACjD;AAEA,MAAI,CAAC,OAAO,MAAM;AAChB,UAAM,QAAQ,2BAAS,cAAc,CAAC,SAAQ;AAC5C,YAAM,OAAO,UAAU,aAAa,QAAQ,GAAG,IAAI;AAGnD,UAAI,SAAS;AACX,eAAO,aAAa,QAAQ,KAAK,IAAI,IAAI,aAAa,QAAQ,KAAK,KAAK,UAAU,YAAY,CAAC;AAAA,MACjG;AAEA,UAAI,MAAM;AACR,aAAQ,KAAK,MAAM,IAAI,CAAC;AAAA,MAC1B;AAEA,UAAI,SAAS;AACX,cAAM,gBAAgB,CAAC,UAAwB;AAC7C,cAAI,MAAM,QAAQ;AAChB,iBAAI,MAAM,WAAW,KAAK,MAAM,MAAM,QAAQ,IAAI,IAAI;AAAA,QAC1D;AAEA,eAAO,iBAAiB,WAAW,aAAa;AAEhD,eAAO,MAAM,OAAO,oBAAoB,WAAW,aAAa;AAAA,MAClE;AAAA,IACF,CAAC;AAED,UAAM,EAAC,WAAW,QAAO;AAEzB,WAAO,OAAO;AAAA,MACZ,IAAI,OAAU;AACZ,sBAAc,KAAK,KAAK;AACxB,YAAI,KAAK;AAAA,MACX;AAAA,MACA,OAAO,SAAqB;AAC1B,cAAM,QAAQ,QAAQ,sBAAI,KAAK,CAAC;AAEhC,sBAAc,KAAK,KAAK;AACxB,YAAI,KAAK;AAAA,MACX;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAEA,SAAO,OAAO;AAChB;","names":[]}